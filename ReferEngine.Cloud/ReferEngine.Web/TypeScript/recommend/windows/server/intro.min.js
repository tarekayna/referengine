define(["require","exports","common","../common/Functions"],function(n,t,i,r){var u=i,f=r;$(document).ready(function(){function o(){var n="fb_access_code="+e+"&re_auth_token="+r;return n=n.replace("#","%23"),u.Url.base+"/recommend/win8/recommend?"+n}var s=$(".login"),h=$("#re-cancel"),c=$("#dontAsk"),n=u.messenger,t=f.ClientFunction,r=null,e=null,i=u.MixPanel;s.click(function(){n.call(t.setLoadingText,{text:"Loading..."}),n.call(t.showLoading),n.call(t.authFacebook),i.track("Rcmnd Intro Start")}),h.click(function(){var r=c[0].checked;n.call(t.setAutoAsk,{askAgain:!r}),n.call(t.hide),i.track("Rcmnd Intro Cancel",{"Dont Ask Again":r})}),n.addMessageHandler("loading-closed",function(){i.track("Rcmnd Intro Loading Closed")}),n.addMessageHandler("intro-page-visible",function(){i.track("Rcmnd Intro")}),n.addMessageHandler("auth-facebook-result",function(i){var u=i.authResult;u.success?(e=u.code,r&&n.call(t.navigate,{url:o()})):(n.call(t.setLoadingText,{text:"Error: You must authorize Refer Engine to use your Facebook information."}),n.call(t.showLoading))}),n.addMessageHandler("auth-app-result",function(i){var u=i.authResult;u.success&&(r=u.code,e&&n.call(t.navigate,{url:o()}))}),n.call(t.hideLoading),n.call(t.setIntroPageLoaded),n.call(t.authApp)})})