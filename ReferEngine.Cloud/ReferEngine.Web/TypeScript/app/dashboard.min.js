var ko,Date2,View;(function(n){n._map=[],n._map[0]="Table",n.Table=0,n._map[1]="Map",n.Map=1,n._map[2]="Chart",n.Chart=2,n._map[3]="People",n.People=3})(View||(View={}));var NotificationType=function(){function n(){}return n.none="",n.info="info",n.success="success",n.error="error",n}(),Notifications=function(){function n(){}return n.show=function(n,t){$(".top-right").notify({message:{text:n},transition:"fade",type:t}).show()},n}(),Page=function(){function n(){}return n.currentView=View.Chart,n.who="recommended",n.timespan="day",n.getUnitName=function(){return n.who==="launched"?"App Launches":n.who==="intro"?"Intro Views":n.who==="recommended"?"Recommendations":void 0},n.initDateRangePicker=function(){var t={Today:["today","today","hour"],Yesterday:["yesterday","yesterday","hour"],"Last 7 Days":[Date2.today().add({days:-6}),"today"],"Last 30 Days":[Date2.today().add({days:-29}),"today"],"This Month":[Date2.today().moveToFirstDayOfMonth(),Date2.today().moveToLastDayOfMonth()],"Last Month":[Date2.today().moveToFirstDayOfMonth().add({months:-1}),Date2.today().moveToFirstDayOfMonth().add({days:-1})]};$("#date-range").daterangepicker({ranges:t,opens:"left",format:"MM/dd/yyyy",separator:" to ",startDate:n.startDate,endDate:n.endDate,minDate:"01/01/2012",maxDate:Date2.today(),locale:{applyLabel:null,fromLabel:"From",toLabel:"To",customRangeLabel:"Choose Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!0,buttonClasses:["btn-danger"]},function(i,r){var f,u,e,o;if(i.compareTo(n.startDate)!==0||r.compareTo(n.endDate)!==0){f=!0;for(u in t)if(e=t[u][0]==="today"?Date2.today():t[u][0]==="yesterday"?Date2.today().add({days:-1}):t[u][0],o=t[u][1]==="today"?Date2.today():t[u][1]==="yesterday"?Date2.today().add({days:-1}):t[u][1],Date2.compare(i,e)===0&&Date2.compare(r,o)===0){$("#date-range span").html(u),f=!1;break}f&&$("#date-range span").html(i.toString("MMMM d, yyyy")+" - "+r.toString("MMMM d, yyyy")),n.timespan=i.clone().add(1).days().compareTo(r)==-1?"day":"hour",n.startDate=i,n.endDate=r,n.refreshView()}}),$("#date-range span").html("Last 7 Days")},n.initWhoSelector=function(){$(".who").click(function(){var t=$(this).attr("data-who");n.who!==t&&(n.who=t,n.refreshView()),$("#current-who").text($(this).text())})},n.initTabs=function(){$("#tableTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#mapTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#peopleTab").click(function(n){n.preventDefault(),$(this).tab("show")});$('a[data-toggle="tab"]').on("shown",function(t){t.target.hash==="#mapTab"?(Map.init(),n.currentView=View.Map):t.target.hash==="#chartTab"?(Chart.init(),n.currentView=View.Chart):t.target.hash==="#tableTab"?n.currentView=View.Table:t.target.hash==="#peopleTab"&&(People.init(),n.currentView=View.People),n.refreshView()})},n.refreshView=function(){n.currentView===View.Table?Table.refresh():n.currentView===View.Chart?Chart.refresh():n.currentView===View.Map?Map.refresh():n.currentView===View.People&&People.refresh()},n.initPage=function(){n.startDate=Date2.today().add({days:-6}),n.endDate=Date2.today(),n.initTabs(),n.initDateRangePicker(),n.initWhoSelector(),n.refreshView()},n}(),Chart=function(){function n(){}return n.chart=null,n.chartData=[],n.timespan="day",n.how="line-chart",n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n.initHowSelector=function(){$(".chart-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how-chart").text($(this).text())})},n.onDataRequestSuccess=function(t){var r,i,u,f;for(n.chartData=[],n.chartData.push(["Date","# of "+Page.getUnitName()]),r=0;r<t.length;r++)n.chartData.push([t[r].Desc,t[r].Result]);i=document.getElementById("chart"),n.how==="line-chart"?n.chart=new google.visualization.LineChart(i):n.how==="pie-chart"?n.chart=new google.visualization.PieChart(i):n.how==="area-chart"?n.chart=new google.visualization.AreaChart(i):n.how==="column-chart"?n.chart=new google.visualization.ColumnChart(i):n.how==="bar-chart"&&(n.chart=new google.visualization.BarChart(i)),u=google.visualization.arrayToDataTable(n.chartData),f={legend:{position:"bottom"}},n.chart.draw(u,f),Notifications.show("Success: chart updated",NotificationType.success)},n.onDataRequestError=function(){Notifications.show("Error: could not update chart",NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=Page.startDate.toString(t)+" 00:00:00",r=Page.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:Page.who,startDate:i,endDate:r,timeZoneOffset:Date2.today().getUTCOffset(),timespan:Page.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),Notifications.show("Refreshing chart...",NotificationType.info)},n}(),Table=function(){function n(){}return n.table=null,n.tableData=[],n.timespan="day",n.how="table",n.isInitialized=!1,n.onDataRequestSuccess=function(t){var i,r,u,f;for(n.tableData=[],n.tableData.push(["Date","# of "+Page.getUnitName()]),i=0;i<t.length;i++)n.tableData.push([t[i].Desc,t[i].Result]);r=document.getElementById("table"),n.how==="table"&&(n.table=new google.visualization.Table(r)),u=google.visualization.arrayToDataTable(n.tableData),f={cssClassNames:{tableCell:"txt-middle"},page:"enable",pageSize:15},n.table.draw(u,f),Notifications.show("Success: table updated",NotificationType.success)},n.onDataRequestError=function(){Notifications.show("Error: could not update table",NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=Page.startDate.toString(t)+" 00:00:00",r=Page.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:Page.who,startDate:i,endDate:r,timeZoneOffset:Date2.today().getUTCOffset(),timespan:Page.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),Notifications.show("Refreshing table...",NotificationType.info)},n}(),Map=function(){function n(){}return n.map=null,n.mapData=[],n.dataTable=[],n.how="location-map",n.options={region:null,displayMode:"markers",colorAxis:{colors:["0099e5","rgb(140, 34, 222)"]},enableRegionInteractivity:!0,datalessRegionColor:"CCCCCC"},n.draw=function(){n.map.draw(n.dataTable,n.options)},n.refresh=function(){var t="dd MMMM yyyy",u=Page.startDate.toString(t)+" 00:00:00",f=Page.endDate.clone().add({days:1}).toString(t)+" 00:00:01",i,r;n.map===null&&(n.map=new google.visualization.GeoChart(document.getElementById("map-canvas")),google.visualization.events.addListener(n.map,"regionClick",function(t){n.options.region=n.options.region===t.region?null:t.region,n.draw()})),i=function(t){var i,r;for(n.mapData=[],n.mapData.push(["City","# of "+Page.getUnitName()]),i=0;i<t.length;i++)r=t[i].City,t[i].Region&&(r+=", "+t[i].Region),r+=", "+t[i].Country,n.mapData.push([r,t[i].Result]);n.dataTable=google.visualization.arrayToDataTable(n.mapData),n.draw(),Notifications.show("Success: map updated",NotificationType.success)},r=function(){Notifications.show("Error: could not update map",NotificationType.error)},$.ajax("../GetAppDashboardMapData",{type:"POST",data:{id:re.appId,who:Page.who,startDate:u,endDate:f,timeZoneOffset:Date2.today().getUTCOffset()},dataType:"json",error:r,success:i}),Notifications.show("Refreshing map...",NotificationType.info)},n.initHowSelector=function(){$(".map-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how").text($(this).text())})},n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n}(),PeopleViewModel=function(){function n(){this.PeopleData=ko.observableArray()}return n}(),People=function(){function n(){}return n.isInitialized=!1,n.init=function(){n.isInitialized||(n.viewModel=new PeopleViewModel,ko.applyBindings(n.viewModel),n.isInitialized=!0)},n.onDataRequestSuccess=function(t){n.isInitialized||n.init(),n.viewModel.PeopleData.removeAll();for(var i=0;i<t.length;i++)n.viewModel.PeopleData.push(t[i]);Notifications.show("Success: people view updated",NotificationType.success)},n.onDataRequestError=function(){Notifications.show("Error: could not update people view",NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=Page.startDate.toString(t)+" 00:00:00",r=Page.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardPeopleData",{type:"POST",data:{id:re.appId,who:"recommended",startDate:i,endDate:r,timeZoneOffset:Date2.today().getUTCOffset()},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),Notifications.show("Updating people view...",NotificationType.info)},n}();require(["../lib/knockout","../lib/date","../lib/daterangepicker"],function(n){ko=n,Date2=Date,$(document).ready(Page.initPage)})