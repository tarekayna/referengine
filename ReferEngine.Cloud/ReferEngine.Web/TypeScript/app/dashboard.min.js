function setTabClickEvents(){$("#overviewTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#mapTab").click(function(n){n.preventDefault(),$(this).tab("show")})}function setMapHowHandlers(){$(".map-how").click(function(){var n=$(this).attr("data-how");Map.how!==n&&(Map.how=n,Map.refresh()),$("#current-how").text($(this).text())})}function setMapWhoHandlers(){$(".map-who").click(function(){var n=$(this).attr("data-who");Map.who!==n&&(Map.who=n,Map.refresh()),$("#current-who").text($(this).text())})}function initMapDateRangePicker(){$("#map-date-range").daterangepicker({ranges:{Today:["today","today"],Yesterday:["yesterday","yesterday"],"Last 7 Days":[Date2.today().add({days:-6}),"today"],"Last 30 Days":[Date2.today().add({days:-29}),"today"],"This Month":[Date2.today().moveToFirstDayOfMonth(),Date2.today().moveToLastDayOfMonth()],"Last Month":[Date2.today().moveToFirstDayOfMonth().add({months:-1}),Date2.today().moveToFirstDayOfMonth().add({days:-1})]},opens:"left",format:"MM/dd/yyyy",separator:" to ",startDate:Date2.today().add({days:-29}),endDate:Date2.today(),minDate:"01/01/2012",maxDate:Date2.today(),locale:{applyLabel:null,fromLabel:"From",toLabel:"To",customRangeLabel:"Choose Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!0,buttonClasses:["btn-danger"]},function(n,t){$("#map-date-range span").html(n.toString("MMMM d, yyyy")+" - "+t.toString("MMMM d, yyyy"));var i="dd MMMM yyyy",r=n.toString(i)+" 00:00:00",u=t.toString(i)+"23:59:59";Map.refresh(r,u)}),$("#map-date-range span").html(Date2.today().add({days:-29}).toString("MMMM d, yyyy")+" - "+Date2.today().toString("MMMM d, yyyy"))}var Date2=Date,NotificationType=function(){function n(){}return n.none="",n.info="info",n.success="success",n.error="error",n}(),Notifications=function(){function n(){}return n.show=function(n,t){$(".top-right").notify({message:{text:n},transition:"fade",type:t}).show()},n}(),Chart=function(){function n(){}return n.chart=null,n.chartData=[],n.who="launched",n.when="past-30-days",n.timespan="day",n.how="pie-chart",n.draw=function(){var t=google.visualization.arrayToDataTable([["Task","Hours per Day"],["Work",11],["Eat",2],["Commute",2],["Watch TV",2],["Sleep",7]]);n.chart.draw(t,{})},n.onDataRequestSuccess=function(t){n.chartData=[];for(var i=0;i<t.length;i++)n.chartData.push({});Map.how==="line-chart"&&(n.chart=new google.visualization.LineChart(document.getElementById("chart"))),Notifications.show("Success: map updated",NotificationType.success)},n.onDataRequestError=function(){Notifications.show("Error: could not update chart",NotificationType.error)},n.refresh=function(){$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:n.who,when:n.when,timespan:n.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),Notifications.show("Refreshing chart...",NotificationType.info)},n}(),Map=function(){function n(){}return n.map=null,n.mapData=[],n.heatData=[],n.markers=[],n.how="location-map",n.who="launched",n.startDate=null,n.endDate=null,n.center=new google.maps.LatLng(0,0),n.options={center:n.center,zoom:2,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,mapTypeControl:!1},n.updateHeatmapData=function(){n.heatData=[];for(var t=0;t<n.mapData.length;t++)n.heatData.push(n.mapData[t].latlong);n.heatMap=new google.maps.visualization.HeatmapLayer({data:n.heatData})},n.showHeatmap=function(){n.updateHeatmapData(),n.heatMap.setMap(n.map)},n.hideHeatmap=function(){n.heatMap!==undefined&&n.heatMap.setMap(null)},n.removeMarkers=function(){for(var t=0;t<n.markers.length;t++)n.markers[t].setMap(null)},n.updateMarkers=function(){n.removeMarkers();for(var t=0;t<n.mapData.length;t++)n.markers.push(new google.maps.Marker({position:n.mapData[t].latlong,map:n.map,title:n.mapData[t].city,origin:new google.maps.Point(16,16),anchor:new google.maps.Point(16,16),icon:"https://referenginestorage.blob.core.windows.net/referengine-design/logo-mark-32.png"}))},n.refresh=function(t,i){typeof t=="undefined"&&(t=n.startDate),typeof i=="undefined"&&(i=n.endDate),n.startDate=t,n.endDate=i,n.map===null&&(n.map=new google.maps.Map(document.getElementById("map-canvas"),n.options));var r=function(t){n.mapData=[];for(var i=0;i<t.length;i++)n.mapData.push({latlong:new google.maps.LatLng(t[i].Latitude,t[i].Longitude),city:t[i].City});n.how==="location-map"?(n.updateMarkers(),n.hideHeatmap()):n.how==="heat-map"&&(n.removeMarkers(),n.showHeatmap()),Notifications.show("Success: map updated",NotificationType.success)},u=function(){Notifications.show("Error: could not update map",NotificationType.error)};$.ajax("../GetAppDashboardMapData",{type:"POST",data:{id:re.appId,who:n.who,startDate:n.startDate,endDate:n.endDate},dataType:"json",error:u,success:r}),Notifications.show("Refreshing map...",NotificationType.info)},n}();$(document).ready(function(){setTabClickEvents();var n=!1;$('a[data-toggle="tab"]').on("shown",function(t){t.target.hash==="#mapTab"?(Map.refresh(),n||(initMapDateRangePicker(),setMapHowHandlers(),setMapWhoHandlers())):t.target.hash==="#chartsTab"?Chart.refresh():t.target.hash==="#overviewTab"})})