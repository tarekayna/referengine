var View;(function(n){n._map=[],n._map[0]="Overview",n.Overview=0,n._map[1]="Map",n.Map=1,n._map[2]="Chart",n.Chart=2})(View||(View={}));var Date2=Date,NotificationType=function(){function n(){}return n.none="",n.info="info",n.success="success",n.error="error",n}(),Notifications=function(){function n(){}return n.show=function(n,t){$(".top-right").notify({message:{text:n},transition:"fade",type:t}).show()},n}(),Page=function(){function n(){}return n.currentView=View.Overview,n.who="launched",n.startDate=Date2.today().add({days:-29}),n.endDate=Date2.today(),n.initDateRangePicker=function(){var t={Today:["today","today","hour"],Yesterday:["yesterday","yesterday","hour"],"Last 7 Days":[Date2.today().add({days:-6}),"today"],"Last 30 Days":[Date2.today().add({days:-29}),"today"],"This Month":[Date2.today().moveToFirstDayOfMonth(),Date2.today().moveToLastDayOfMonth()],"Last Month":[Date2.today().moveToFirstDayOfMonth().add({months:-1}),Date2.today().moveToFirstDayOfMonth().add({days:-1})]};$("#date-range").daterangepicker({ranges:t,opens:"left",format:"MM/dd/yyyy",separator:" to ",startDate:Date2.today().add({days:-29}),endDate:Date2.today(),minDate:"01/01/2012",maxDate:Date2.today(),locale:{applyLabel:null,fromLabel:"From",toLabel:"To",customRangeLabel:"Choose Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!0,buttonClasses:["btn-danger"]},function(i,r){var f,u,e,o;if(i.compareTo(n.startDate)!==0||r.compareTo(n.endDate)!==0){f=!0;for(u in t)if(e=t[u][0]==="today"?Date2.today():t[u][0]==="yesterday"?Date2.today().add({days:-1}):t[u][0],o=t[u][1]==="today"?Date2.today():t[u][1]==="yesterday"?Date2.today().add({days:-1}):t[u][1],Date2.compare(i,e)===0&&Date2.compare(r,o)===0){$("#date-range span").html(u),f=!1;break}f&&$("#date-range span").html(i.toString("MMMM d, yyyy")+" - "+r.toString("MMMM d, yyyy")),Chart.timespan=i.clone().add(1).days().compareTo(r)==-1?"day":"hour",n.startDate=i,n.endDate=r,n.refreshView()}}),$("#date-range span").html("Last 30 days")},n.initWhoSelector=function(){$(".who").click(function(){var t=$(this).attr("data-who");n.who!==t&&(n.who=t,n.refreshView()),$("#current-who").text($(this).text())})},n.initTabs=function(){$("#overviewTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#mapTab").click(function(n){n.preventDefault(),$(this).tab("show")});$('a[data-toggle="tab"]').on("shown",function(t){t.target.hash==="#mapTab"?(Map.init(),n.currentView=View.Map):t.target.hash==="#chartTab"?(Chart.init(),n.currentView=View.Chart):t.target.hash==="#overviewTab"&&(n.currentView=View.Overview),n.refreshView()})},n.refreshView=function(){n.currentView===View.Overview||(n.currentView===View.Chart?Chart.refresh():n.currentView===View.Map&&Map.refresh())},n.initPage=function(){n.initTabs(),n.initDateRangePicker(),n.initWhoSelector()},n}(),Chart=function(){function n(){}return n.chart=null,n.chartData=[],n.timespan="day",n.how="line-chart",n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n.initHowSelector=function(){$(".chart-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how-chart").text($(this).text())})},n.onDataRequestSuccess=function(t){var r,i,u,f;for(n.chartData=[],n.chartData.push(["Date","Launch Count"]),r=0;r<t.length;r++)n.chartData.push([t[r].Desc,t[r].Result]);i=document.getElementById("chart"),n.how==="line-chart"?n.chart=new google.visualization.LineChart(i):n.how==="pie-chart"?n.chart=new google.visualization.PieChart(i):n.how==="area-chart"?n.chart=new google.visualization.AreaChart(i):n.how==="column-chart"?n.chart=new google.visualization.ColumnChart(i):n.how==="bar-chart"&&(n.chart=new google.visualization.BarChart(i)),u=google.visualization.arrayToDataTable(n.chartData),f={},n.chart.draw(u,f),Notifications.show("Success: map updated",NotificationType.success)},n.onDataRequestError=function(){Notifications.show("Error: could not update chart",NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=Page.startDate.toString(t)+" 00:00:00",r=Page.endDate.toString(t)+" 23:59:59";$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:Page.who,startDate:i,endDate:r,timespan:n.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),Notifications.show("Refreshing chart...",NotificationType.info)},n}(),Map=function(){function n(){}return n.map=null,n.mapData=[],n.dataTable=[],n.how="location-map",n.options={region:null,displayMode:"markers",colorAxis:{colors:["0099e5","rgb(140, 34, 222)"]},enableRegionInteractivity:!0,datalessRegionColor:"CCCCCC"},n.draw=function(){n.map.draw(n.dataTable,n.options)},n.refresh=function(){var t="dd MMMM yyyy",u=Page.startDate.toString(t)+" 00:00:00",f=Page.endDate.toString(t)+" 23:59:59",i,r;n.map===null&&(n.map=new google.visualization.GeoChart(document.getElementById("map-canvas")),google.visualization.events.addListener(n.map,"regionClick",function(t){n.options.region=n.options.region===t.region?null:t.region,n.draw()})),i=function(t){var i,r;for(n.mapData=[],n.mapData.push(["City","Launch Count"]),i=0;i<t.length;i++)r=t[i].City+", "+t[i].Region+", "+t[i].Country,n.mapData.push([r,t[i].Result]);n.dataTable=google.visualization.arrayToDataTable(n.mapData),n.draw(),Notifications.show("Success: map updated",NotificationType.success)},r=function(){Notifications.show("Error: could not update map",NotificationType.error)},$.ajax("../GetAppDashboardMapData",{type:"POST",data:{id:re.appId,who:Page.who,startDate:u,endDate:f},dataType:"json",error:r,success:i}),Notifications.show("Refreshing map...",NotificationType.info)},n.initHowSelector=function(){$(".map-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how").text($(this).text())})},n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n}();$(document).ready(Page.initPage)