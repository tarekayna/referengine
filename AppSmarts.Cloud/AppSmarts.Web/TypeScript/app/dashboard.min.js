define(["require","exports","../common/notifications"],function(n,t,i){var r=i,o,u,e;(function(n){n._map=[],n._map[0]="Table",n.Table=0,n._map[1]="Map",n.Map=1,n._map[2]="Chart",n.Chart=2,n._map[3]="People",n.People=3})(e||(e={}));var f=function(){function n(){}return n.currentView=e.Chart,n.who="recommended",n.timespan="day",n.getUnitName=function(){return n.who==="launched"?"App Launches":n.who==="intro"?"Intro Views":n.who==="recommended"?"Recommendations":void 0},n.initDateRangePicker=function(){var t={Today:["today","today","hour"],Yesterday:["yesterday","yesterday","hour"],"Last 7 Days":[u.today().add({days:-6}),"today"],"Last 30 Days":[u.today().add({days:-29}),"today"],"This Month":[u.today().moveToFirstDayOfMonth(),u.today().moveToLastDayOfMonth()],"Last Month":[u.today().moveToFirstDayOfMonth().add({months:-1}),u.today().moveToFirstDayOfMonth().add({days:-1})]};$("#date-range").daterangepicker({ranges:t,opens:"left",format:"MM/dd/yyyy",separator:" to ",startDate:n.startDate,endDate:n.endDate,minDate:"01/01/2012",maxDate:u.today(),locale:{applyLabel:null,fromLabel:"From",toLabel:"To",customRangeLabel:"Choose Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!0,buttonClasses:["btn-danger"]},function(i,r){var e,f,o,s;if(i.compareTo(n.startDate)!==0||r.compareTo(n.endDate)!==0){e=!0;for(f in t)if(o=t[f][0]==="today"?u.today():t[f][0]==="yesterday"?u.today().add({days:-1}):t[f][0],s=t[f][1]==="today"?u.today():t[f][1]==="yesterday"?u.today().add({days:-1}):t[f][1],u.compare(i,o)===0&&u.compare(r,s)===0){$("#date-range span").html(f),e=!1;break}e&&$("#date-range span").html(i.toString("MMMM d, yyyy")+" - "+r.toString("MMMM d, yyyy")),n.timespan=i.clone().add(1).days().compareTo(r)==-1?"day":"hour",n.startDate=i,n.endDate=r,n.refreshView()}}),$("#date-range span").html("Last 7 Days")},n.initWhoSelector=function(){$(".who").click(function(){var t=$(this).attr("data-who");n.who!==t&&(n.who=t,n.refreshView()),$("#current-who").text($(this).text())})},n.initTabs=function(){$("#tableTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#mapTab").click(function(n){n.preventDefault(),$(this).tab("show")}),$("#peopleTab").click(function(n){n.preventDefault(),$(this).tab("show")});$('a[data-toggle="tab"]').on("shown",function(t){t.target.hash==="#mapTab"?(h.init(),n.currentView=e.Map):t.target.hash==="#chartTab"?(s.init(),n.currentView=e.Chart):t.target.hash==="#tableTab"?n.currentView=e.Table:t.target.hash==="#peopleTab"&&(c.init(),n.currentView=e.People),n.refreshView()})},n.refreshView=function(){n.currentView===e.Table?l.refresh():n.currentView===e.Chart?s.refresh():n.currentView===e.Map?h.refresh():n.currentView===e.People&&c.refresh()},n.initPage=function(){n.startDate=u.today().add({days:-6}),n.endDate=u.today(),n.initTabs(),n.initDateRangePicker(),n.initWhoSelector(),n.refreshView()},n}(),s=function(){function n(){}return n.chart=null,n.chartData=[],n.timespan="day",n.how="column-chart",n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n.initHowSelector=function(){$(".chart-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how-chart").text($(this).text())})},n.onDataRequestSuccess=function(t){var u,i,e,o;for(n.chartData=[],n.chartData.push(["Date","# of "+f.getUnitName()]),u=0;u<t.length;u++)n.chartData.push([t[u].Desc,t[u].Result]);i=document.getElementById("chart"),n.how==="line-chart"?n.chart=new google.visualization.LineChart(i):n.how==="pie-chart"?n.chart=new google.visualization.PieChart(i):n.how==="area-chart"?n.chart=new google.visualization.AreaChart(i):n.how==="column-chart"?n.chart=new google.visualization.ColumnChart(i):n.how==="bar-chart"&&(n.chart=new google.visualization.BarChart(i)),e=google.visualization.arrayToDataTable(n.chartData),o={legend:{position:"bottom"}},n.chart.draw(e,o),r.show("Success: chart updated",r.NotificationType.success)},n.onDataRequestError=function(){r.show("Error: could not update chart",r.NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=f.startDate.toString(t)+" 00:00:00",e=f.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:f.who,startDate:i,endDate:e,timeZoneOffset:u.today().getUTCOffset(),timespan:f.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),r.show("Refreshing chart...",r.NotificationType.info)},n}(),l=function(){function n(){}return n.table=null,n.tableData=[],n.timespan="day",n.how="table",n.isInitialized=!1,n.onDataRequestSuccess=function(t){var i,u,e,o;for(n.tableData=[],n.tableData.push(["Date","# of "+f.getUnitName()]),i=0;i<t.length;i++)n.tableData.push([t[i].Desc,t[i].Result]);u=document.getElementById("table"),n.how==="table"&&(n.table=new google.visualization.Table(u)),e=google.visualization.arrayToDataTable(n.tableData),o={cssClassNames:{tableCell:"txt-middle"},page:"enable",pageSize:15},n.table.draw(e,o),r.show("Success: table updated",r.NotificationType.success)},n.onDataRequestError=function(){r.show("Error: could not update table",r.NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=f.startDate.toString(t)+" 00:00:00",e=f.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardChartData",{type:"POST",data:{id:re.appId,who:f.who,startDate:i,endDate:e,timeZoneOffset:u.today().getUTCOffset(),timespan:f.timespan},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),r.show("Refreshing table...",r.NotificationType.info)},n}(),h=function(){function n(){}return n.map=null,n.mapData=[],n.dataTable=[],n.how="location-map",n.options={region:null,displayMode:"markers",colorAxis:{colors:["0099e5","rgb(140, 34, 222)"]},enableRegionInteractivity:!0,datalessRegionColor:"CCCCCC"},n.draw=function(){n.map.draw(n.dataTable,n.options)},n.refresh=function(){var t="dd MMMM yyyy",o=f.startDate.toString(t)+" 00:00:00",s=f.endDate.clone().add({days:1}).toString(t)+" 00:00:01",i,e;n.map===null&&(n.map=new google.visualization.GeoChart(document.getElementById("map-canvas")),google.visualization.events.addListener(n.map,"regionClick",function(t){n.options.region=n.options.region===t.region?null:t.region,n.draw()})),i=function(t){var i,u;for(n.mapData=[],n.mapData.push(["City","# of "+f.getUnitName()]),i=0;i<t.length;i++)u=t[i].City,t[i].Region&&(u+=", "+t[i].Region),u+=", "+t[i].Country,n.mapData.push([u,t[i].Result]);n.dataTable=google.visualization.arrayToDataTable(n.mapData),n.draw(),r.show("Success: map updated",r.NotificationType.success)},e=function(){r.show("Error: could not update map",r.NotificationType.error)},$.ajax("../GetAppDashboardMapData",{type:"POST",data:{id:re.appId,who:f.who,startDate:o,endDate:s,timeZoneOffset:u.today().getUTCOffset()},dataType:"json",error:e,success:i}),r.show("Refreshing map...",r.NotificationType.info)},n.initHowSelector=function(){$(".map-how").click(function(){var t=$(this).attr("data-how");n.how!==t&&(n.how=t,n.refresh()),$("#current-how").text($(this).text())})},n.isInitialized=!1,n.init=function(){n.isInitialized||(n.initHowSelector(),n.isInitialized=!0)},n}(),a=function(){function n(){this.PeopleData=o.observableArray()}return n}(),c=function(){function n(){}return n.isInitialized=!1,n.init=function(){n.isInitialized||(n.viewModel=new a,o.applyBindings(n.viewModel),n.isInitialized=!0)},n.onDataRequestSuccess=function(t){n.isInitialized||n.init(),n.viewModel.PeopleData.removeAll();for(var i=0;i<t.length;i++)n.viewModel.PeopleData.push(t[i]);r.show("Success: people view updated",r.NotificationType.success)},n.onDataRequestError=function(){r.show("Error: could not update people view",r.NotificationType.error)},n.refresh=function(){var t="dd MMMM yyyy",i=f.startDate.toString(t)+" 00:00:00",e=f.endDate.clone().add({days:1}).toString(t)+" 00:00:01";$.ajax("../GetAppDashboardPeopleData",{type:"POST",data:{id:re.appId,who:"recommended",startDate:i,endDate:e,timeZoneOffset:u.today().getUTCOffset()},dataType:"json",error:n.onDataRequestError,success:n.onDataRequestSuccess}),r.show("Updating people view...",r.NotificationType.info)},n}();n(["../lib/knockout","../lib/date","../lib/daterangepicker"],function(n){o=n,u=Date,$(document).ready(f.initPage)})})